!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Tribute=t()}(this,(function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}function i(e,t){return r(e)||o(e,t)||u(e,t)||a()}function r(e){if(Array.isArray(e))return e}function o(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],i=!0,r=!1,o=void 0;try{for(var u=e[Symbol.iterator](),l;!(i=(l=u.next()).done)&&(n.push(l.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{i||null==u.return||u.return()}finally{if(r)throw o}}return n}}function u(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function a(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}if(Array.prototype.find||(Array.prototype.find=function(e,t){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var n=Object(this),i=n.length>>>0,r=t,o,u=0;u<i;u++)if(o=n[u],e.call(r,o,u,n))return o}),window&&"function"!=typeof window.CustomEvent){var s=function e(t,n){n=n||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(t,n.bubbles,n.cancelable,n.detail),i};void 0!==window.Event&&(s.prototype=window.Event.prototype),window.CustomEvent=s}var c=function(){function t(n){e(this,t),this.tribute=n,this.tribute.events=this}return n(t,[{key:"bind",value:function e(t){t.boundKeydown=this.keydown.bind(t,this),t.boundKeyup=this.keyup.bind(t,this),t.boundInput=this.input.bind(t,this),t.addEventListener("keydown",t.boundKeydown,!1),t.addEventListener("keyup",t.boundKeyup,!1),t.addEventListener("input",t.boundInput,!1)}},{key:"unbind",value:function e(t){t.removeEventListener("keydown",t.boundKeydown,!1),t.removeEventListener("keyup",t.boundKeyup,!1),t.removeEventListener("input",t.boundInput,!1),delete t.boundKeydown,delete t.boundKeyup,delete t.boundInput}},{key:"keydown",value:function e(n,i){n.shouldDeactivate(i)&&(n.tribute.isActive=!1,n.tribute.hideMenu());var r=this;n.commandEvent=!1,t.keys().forEach((function(e){e.key===i.keyCode&&(n.commandEvent=!0,n.callbacks()[e.value.toLowerCase()](i,r))}))}},{key:"input",value:function e(t,n){t.inputEvent=!0,t.keyup.call(this,t,n)}},{key:"click",value:function e(t,n){var i=t.tribute;if(i.menu&&i.menu.contains(n.target)){var r=n.target;for(n.preventDefault(),n.stopPropagation();"li"!==r.nodeName.toLowerCase();)if(!(r=r.parentNode)||r===i.menu)throw new Error("cannot find the <li> container for the click");i.selectItemAtIndex(r.getAttribute("data-index"),n),i.hideMenu()}else i.current.element&&!i.current.externalTrigger&&(i.current.externalTrigger=!1,setTimeout((function(){return i.hideMenu()})))}},{key:"keyup",value:function e(t,n){if(t.inputEvent&&(t.inputEvent=!1),t.updateSelection(this),27!==n.keyCode){if(!t.tribute.allowSpaces&&t.tribute.hasTrailingSpace)return t.tribute.hasTrailingSpace=!1,t.commandEvent=!0,void t.callbacks().space(n,this);if(!t.tribute.isActive)if(t.tribute.autocompleteMode)t.callbacks().triggerChar(n,this,"");else{var i=t.getKeyCode(t,this,n);if(isNaN(i)||!i)return;var r=t.tribute.triggers().find((function(e){return e.charCodeAt(0)===i}));void 0!==r&&t.callbacks().triggerChar(n,this,r)}t.tribute.current.mentionText.length<t.tribute.current.collection.menuShowMinLength||((t.tribute.current.trigger||t.tribute.autocompleteMode)&&!1===t.commandEvent||t.tribute.isActive&&8===n.keyCode)&&t.tribute.showMenuFor(this,!0)}}},{key:"shouldDeactivate",value:function e(n){if(!this.tribute.isActive)return!1;if(0===this.tribute.current.mentionText.length){var i=!1;return t.keys().forEach((function(e){n.keyCode===e.key&&(i=!0)})),!i}return!1}},{key:"getKeyCode",value:function e(t,n,i){var r=t.tribute,o=r.range.getTriggerInfo(!1,r.hasTrailingSpace,!0,r.allowSpaces,r.autocompleteMode);return!!o&&o.mentionTriggerChar.charCodeAt(0)}},{key:"updateSelection",value:function e(t){this.tribute.current.element=t;var n=this.tribute.range.getTriggerInfo(!1,this.tribute.hasTrailingSpace,!0,this.tribute.allowSpaces,this.tribute.autocompleteMode);n&&(this.tribute.current.selectedPath=n.mentionSelectedPath,this.tribute.current.mentionText=n.mentionText,this.tribute.current.selectedOffset=n.mentionSelectedOffset)}},{key:"callbacks",value:function e(){var t=this;return{triggerChar:function e(n,i,r){var o=t.tribute;o.current.trigger=r;var u=o.collection.find((function(e){return e.trigger===r}));o.current.collection=u,o.current.mentionText.length>=o.current.collection.menuShowMinLength&&o.inputEvent&&o.showMenuFor(i,!0)},enter:function e(n,i){t.tribute.isActive&&t.tribute.current.filteredItems&&(n.preventDefault(),n.stopPropagation(),setTimeout((function(){t.tribute.selectItemAtIndex(t.tribute.menuSelected,n),t.tribute.hideMenu()}),0))},escape:function e(n,i){t.tribute.isActive&&(n.preventDefault(),n.stopPropagation(),t.tribute.isActive=!1,t.tribute.hideMenu())},tab:function e(n,i){t.callbacks().enter(n,i)},space:function e(n,i){t.tribute.isActive&&(t.tribute.spaceSelectsMatch?t.callbacks().enter(n,i):t.tribute.allowSpaces||(n.stopPropagation(),setTimeout((function(){t.tribute.hideMenu(),t.tribute.isActive=!1}),0)))},up:function e(n,i){if(t.tribute.isActive&&t.tribute.current.filteredItems){n.preventDefault(),n.stopPropagation();var r=t.tribute.current.filteredItems.length,o=t.tribute.menuSelected;r>o&&o>0?(t.tribute.menuSelected--,t.setActiveLi()):0===o&&(t.tribute.menuSelected=r-1,t.setActiveLi(),t.tribute.menu.scrollTop=t.tribute.menu.scrollHeight)}},down:function e(n,i){if(t.tribute.isActive&&t.tribute.current.filteredItems){n.preventDefault(),n.stopPropagation();var r=t.tribute.current.filteredItems.length-1,o=t.tribute.menuSelected;r>o?(t.tribute.menuSelected++,t.setActiveLi()):r===o&&(t.tribute.menuSelected=0,t.setActiveLi(),t.tribute.menu.scrollTop=0)}},delete:function e(n,i){t.tribute.isActive&&t.tribute.current.mentionText.length<1?t.tribute.hideMenu():t.tribute.isActive&&t.tribute.showMenuFor(i)}}}},{key:"setActiveLi",value:function e(t){var n=this.tribute.menu.querySelectorAll("li"),i=n.length>>>0;t&&(this.tribute.menuSelected=parseInt(t));for(var r=0;r<i;r++){var o=n[r];if(r===this.tribute.menuSelected){o.classList.add(this.tribute.current.collection.selectClass);var u=o.getBoundingClientRect(),l=this.tribute.menu.getBoundingClientRect();if(u.bottom>l.bottom){var a=u.bottom-l.bottom;this.tribute.menu.scrollTop+=a}else if(u.top<l.top){var s=l.top-u.top;this.tribute.menu.scrollTop-=s}}else o.classList.remove(this.tribute.current.collection.selectClass)}}},{key:"getFullHeight",value:function e(t,n){var i=t.getBoundingClientRect().height;if(n){var r=t.currentStyle||window.getComputedStyle(t);return i+parseFloat(r.marginTop)+parseFloat(r.marginBottom)}return i}}],[{key:"keys",value:function e(){return[{key:9,value:"TAB"},{key:8,value:"DELETE"},{key:13,value:"ENTER"},{key:27,value:"ESCAPE"},{key:32,value:"SPACE"},{key:38,value:"UP"},{key:40,value:"DOWN"}]}}]),t}(),h=function(){function t(n){e(this,t),this.tribute=n,this.tribute.menuEvents=this,this.menu=this.tribute.menu}return n(t,[{key:"bind",value:function e(t){var n=this;this.menuClickEvent=this.tribute.events.click.bind(null,this),this.menuContainerScrollEvent=this.debounce((function(){n.tribute.isActive&&n.tribute.showMenuFor(n.tribute.current.element,!1)}),300,!1),this.windowResizeEvent=this.debounce((function(){n.tribute.isActive&&n.tribute.range.positionMenuAtCaret(!0)}),300,!1),this.tribute.range.getDocument().addEventListener("MSPointerDown",this.menuClickEvent,!1),this.tribute.range.getDocument().addEventListener("mousedown",this.menuClickEvent,!1),window.addEventListener("resize",this.windowResizeEvent),this.menuContainer?this.menuContainer.addEventListener("scroll",this.menuContainerScrollEvent,!1):window.addEventListener("scroll",this.menuContainerScrollEvent)}},{key:"unbind",value:function e(t){this.tribute.range.getDocument().removeEventListener("mousedown",this.menuClickEvent,!1),this.tribute.range.getDocument().removeEventListener("MSPointerDown",this.menuClickEvent,!1),window.removeEventListener("resize",this.windowResizeEvent),this.menuContainer?this.menuContainer.removeEventListener("scroll",this.menuContainerScrollEvent,!1):window.removeEventListener("scroll",this.menuContainerScrollEvent)}},{key:"debounce",value:function e(t,n,i){var r=arguments,o=this,u;return function(){var e=o,l=r,a=function n(){u=null,i||t.apply(e,l)},s=i&&!u;clearTimeout(u),u=setTimeout(a,n),s&&t.apply(e,l)}}}]),t}(),d=function(){function t(n){e(this,t),this.tribute=n,this.tribute.range=this}return n(t,[{key:"getDocument",value:function e(){var t;return this.tribute.current.collection&&(t=this.tribute.current.collection.iframe),t?t.contentWindow.document:document}},{key:"positionMenuAtCaret",value:function e(t){var n=this,i=this.tribute.current,r,o=this.getTriggerInfo(!1,this.tribute.hasTrailingSpace,!0,this.tribute.allowSpaces,this.tribute.autocompleteMode);if(void 0!==o){if(!this.tribute.positionMenu)return void(this.tribute.menu.style.cssText="display: block;");r=this.isContentEditable(i.element)?this.getContentEditableCaretPosition(o.mentionPosition):this.getTextAreaOrInputUnderlinePosition(this.tribute.current.element,o.mentionPosition),this.tribute.menu.style.cssText="top: ".concat(r.top,"px;\n                                     left: ").concat(r.left,"px;\n                                     right: ").concat(r.right,"px;\n                                     bottom: ").concat(r.bottom,"px;\n                                     position: absolute;\n                                     display: block;"),"auto"===r.left&&(this.tribute.menu.style.left="auto"),"auto"===r.top&&(this.tribute.menu.style.top="auto"),t&&this.scrollIntoView(),window.setTimeout((function(){var e={width:n.tribute.menu.offsetWidth,height:n.tribute.menu.offsetHeight},i=n.isMenuOffScreen(r,e),o=window.innerWidth>e.width&&(i.left||i.right),u=window.innerHeight>e.height&&(i.top||i.bottom);(o||u)&&(n.tribute.menu.style.cssText="display: none",n.positionMenuAtCaret(t))}),0)}else this.tribute.menu.style.cssText="display: none"}},{key:"selectElement",value:function e(t,n,i){var r,o=t;if(n)for(var u=0;u<n.length;u++){if(void 0===(o=o.childNodes[n[u]]))return;for(;o.length<i;)i-=o.length,o=o.nextSibling;0!==o.childNodes.length||o.length||(o=o.previousSibling)}var l=this.getWindowSelection();(r=this.getDocument().createRange()).setStart(o,i),r.setEnd(o,i),r.collapse(!0);try{l.removeAllRanges()}catch(e){}l.addRange(r),t.focus()}},{key:"replaceTriggerText",value:function e(t,n,i,r,o){var u=this.getTriggerInfo(!0,i,n,this.tribute.allowSpaces,this.tribute.autocompleteMode);if(void 0!==u){var l=this.tribute.current,a=new CustomEvent("tribute-replaced",{detail:{item:o,instance:l,context:u,event:r}});if(this.isContentEditable(l.element)){var s;t+="string"==typeof this.tribute.replaceTextSuffix?this.tribute.replaceTextSuffix:" ";var c=u.mentionPosition+u.mentionText.length;this.tribute.autocompleteMode||(c+=u.mentionTriggerChar.length),this.pasteHtml(t,u.mentionPosition,c)}else{var h=this.tribute.current.element,d="string"==typeof this.tribute.replaceTextSuffix?this.tribute.replaceTextSuffix:" ";t+=d;var f=u.mentionPosition,m=u.mentionPosition+u.mentionText.length+d.length;this.tribute.autocompleteMode||(m+=u.mentionTriggerChar.length-1),h.value=h.value.substring(0,f)+t+h.value.substring(m,h.value.length),h.selectionStart=f+t.length,h.selectionEnd=f+t.length}l.element.dispatchEvent(new CustomEvent("input",{bubbles:!0})),l.element.dispatchEvent(a)}}},{key:"pasteHtml",value:function e(t,n,i){var r,o;o=this.getWindowSelection(),(r=this.getDocument().createRange()).setStart(o.anchorNode,n),r.setEnd(o.anchorNode,i),r.deleteContents();var u=this.getDocument().createElement("div");u.innerHTML=t;for(var l=this.getDocument().createDocumentFragment(),a,s;a=u.firstChild;)s=l.appendChild(a);r.insertNode(l),s&&((r=r.cloneRange()).setStartAfter(s),r.collapse(!0),o.removeAllRanges(),o.addRange(r))}},{key:"getWindowSelection",value:function e(){return this.tribute.collection.iframe?this.tribute.collection.iframe.contentWindow.getSelection():window.getSelection()}},{key:"getNodePositionInParent",value:function e(t){if(null===t.parentNode)return 0;for(var n=0;n<t.parentNode.childNodes.length;n++){var i;if(t.parentNode.childNodes[n]===t)return n}}},{key:"getContentEditableSelectedPath",value:function e(t){var n=this.getWindowSelection(),i=n.anchorNode,r=[],o;if(null!=i){for(var u,l=i.contentEditable;null!==i&&"true"!==l;)u=this.getNodePositionInParent(i),r.push(u),null!==(i=i.parentNode)&&(l=i.contentEditable);return r.reverse(),{selected:i,path:r,offset:o=n.getRangeAt(0).startOffset}}}},{key:"getTextPrecedingCurrentSelection",value:function e(){var t=this.tribute.current,n="";if(this.isContentEditable(t.element)){var i=this.getWindowSelection().anchorNode;if(null!=i){var r=i.textContent,o=this.getWindowSelection().getRangeAt(0).startOffset;r&&o>=0&&(n=r.substring(0,o))}}else{var u=this.tribute.current.element;if(u){var l=u.selectionStart;u.value&&l>=0&&(n=u.value.substring(0,l))}}return n}},{key:"getLastWordInText",value:function e(t){var n,i;return t=t.replace(/\u00A0/g," "),(n=this.tribute.autocompleteSeparator?t.split(this.tribute.autocompleteSeparator):t.split(/\s+/))[n.length-1].trim()}},{key:"getTriggerInfo",value:function e(t,n,i,r,o){var u=this,l=this.tribute.current,a,s,c;if(this.isContentEditable(l.element)){var h=this.getContentEditableSelectedPath(l);h&&(a=h.selected,s=h.path,c=h.offset)}else a=this.tribute.current.element;var d=this.getTextPrecedingCurrentSelection(),f=this.getLastWordInText(d);if(o)return{mentionPosition:d.length-f.length,mentionText:f,mentionSelectedElement:a,mentionSelectedPath:s,mentionSelectedOffset:c};if(null!=d){var m=-1,p;if(this.tribute.collection.forEach((function(e){var t=e.trigger,n=e.requireLeadingSpace?u.lastIndexWithLeadingSpace(d,t):d.lastIndexOf(t);n>m&&(m=n,p=t,i=e.requireLeadingSpace)})),m>=0&&(0===m||!i||/[\xA0\s]/g.test(d.substring(m-1,m)))){var v=d.substring(m+p.length,d.length);p=d.substring(m,m+p.length);var g=v.substring(0,1),b=v.length>0&&(" "===g||" "===g);n&&(v=v.trim());var y=r?/[^\S ]/g:/[\xA0\s]/g;if(this.tribute.hasTrailingSpace=y.test(v),!b&&(t||!y.test(v)))return{mentionPosition:m,mentionText:v,mentionSelectedElement:a,mentionSelectedPath:s,mentionSelectedOffset:c,mentionTriggerChar:p}}}}},{key:"lastIndexWithLeadingSpace",value:function e(t,n){for(var i=t.split("").reverse().join(""),r=-1,o=0,u=t.length;o<u;o++){for(var l=o===t.length-1,a=/\s/.test(i[o+1]),s=!0,c=n.length-1;c>=0;c--)if(n[c]!==i[o-c]){s=!1;break}if(s&&(l||a)){r=t.length-1-o;break}}return r}},{key:"isContentEditable",value:function e(t){return"INPUT"!==t.nodeName&&"TEXTAREA"!==t.nodeName}},{key:"isMenuOffScreen",value:function e(t,n){var i=window.innerWidth,r=window.innerHeight,o=document.documentElement,u=(window.pageXOffset||o.scrollLeft)-(o.clientLeft||0),l=(window.pageYOffset||o.scrollTop)-(o.clientTop||0),a="number"==typeof t.top?t.top:l+r-t.bottom-n.height,s="number"==typeof t.right?t.right:t.left+n.width,c="number"==typeof t.bottom?t.bottom:t.top+n.height,h="number"==typeof t.left?t.left:u+i-t.right-n.width;return{top:a<Math.floor(l),right:s>Math.ceil(u+i),bottom:c>Math.ceil(l+r),left:h<Math.floor(u)}}},{key:"getMenuDimensions",value:function e(){var t={width:null,height:null};return this.tribute.menu.style.cssText="top: 0px;\n                                 left: 0px;\n                                 position: fixed;\n                                 display: block;\n                                 visibility; hidden;",t.width=this.tribute.menu.offsetWidth,t.height=this.tribute.menu.offsetHeight,this.tribute.menu.style.cssText="display: none;",t}},{key:"getTextAreaOrInputUnderlinePosition",value:function e(t,n,i){var r=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"],o=null!==window.mozInnerScreenX,u=this.getDocument().createElement("div");u.id="input-textarea-caret-position-mirror-div",this.getDocument().body.appendChild(u);var l=u.style,a=window.getComputedStyle?getComputedStyle(t):t.currentStyle;l.whiteSpace="pre-wrap","INPUT"!==t.nodeName&&(l.wordWrap="break-word"),l.position="absolute",l.visibility="hidden",r.forEach((function(e){l[e]=a[e]})),o?(l.width="".concat(parseInt(a.width)-2,"px"),t.scrollHeight>parseInt(a.height)&&(l.overflowY="scroll")):l.overflow="hidden",u.textContent=t.value.substring(0,n),"INPUT"===t.nodeName&&(u.textContent=u.textContent.replace(/\s/g," "));var s=this.getDocument().createElement("span");s.textContent=t.value.substring(n)||".",u.appendChild(s);var c=t.getBoundingClientRect(),h=document.documentElement,d=(window.pageXOffset||h.scrollLeft)-(h.clientLeft||0),f=(window.pageYOffset||h.scrollTop)-(h.clientTop||0),m=0,p=0;this.menuContainerIsBody&&(m=c.top,p=c.left);var v={top:m+f+s.offsetTop+parseInt(a.borderTopWidth)+parseInt(a.fontSize)-t.scrollTop,left:p+d+s.offsetLeft+parseInt(a.borderLeftWidth)},g=window.innerWidth,b=window.innerHeight,y=this.getMenuDimensions(),w=this.isMenuOffScreen(v,y);w.right&&(v.right=g-v.left,v.left="auto");var T=this.tribute.menuContainer?this.tribute.menuContainer.offsetHeight:this.getDocument().body.offsetHeight;if(w.bottom){var C,S=T-(b-(this.tribute.menuContainer?this.tribute.menuContainer.getBoundingClientRect():this.getDocument().body.getBoundingClientRect()).top);v.bottom=S+(b-c.top-s.offsetTop),v.top="auto"}return(w=this.isMenuOffScreen(v,y)).left&&(v.left=g>y.width?d+g-y.width:d,delete v.right),w.top&&(v.top=b>y.height?f+b-y.height:f,delete v.bottom),this.getDocument().body.removeChild(u),v}},{key:"getContentEditableCaretPosition",value:function e(t){var n,i=this.getWindowSelection();(n=this.getDocument().createRange()).setStart(i.anchorNode,t),n.setEnd(i.anchorNode,t),n.collapse(!1);var r=n.getBoundingClientRect(),o=document.documentElement,u=(window.pageXOffset||o.scrollLeft)-(o.clientLeft||0),l=(window.pageYOffset||o.scrollTop)-(o.clientTop||0),a,s,c={left:r.left+u,top:r.top+r.height+l},h=window.innerWidth,d=window.innerHeight,f=this.getMenuDimensions(),m=this.isMenuOffScreen(c,f);m.right&&(c.left="auto",c.right=h-r.left-u);var p=this.tribute.menuContainer?this.tribute.menuContainer.offsetHeight:this.getDocument().body.offsetHeight;if(m.bottom){var v,g=p-(d-(this.tribute.menuContainer?this.tribute.menuContainer.getBoundingClientRect():this.getDocument().body.getBoundingClientRect()).top);c.top="auto",c.bottom=g+(d-r.top)}return(m=this.isMenuOffScreen(c,f)).left&&(c.left=h>f.width?u+h-f.width:u,delete c.right),m.top&&(c.top=d>f.height?l+d-f.height:l,delete c.bottom),this.menuContainerIsBody||(c.left=c.left?c.left-this.tribute.menuContainer.offsetLeft:c.left,c.top=c.top?c.top-this.tribute.menuContainer.offsetTop:c.top),c}},{key:"scrollIntoView",value:function e(t){var n=20,i,r=100,o=this.menu;if(void 0!==o){for(;void 0===i||0===i.height;)if(0===(i=o.getBoundingClientRect()).height&&(void 0===(o=o.childNodes[0])||!o.getBoundingClientRect))return;var u=i.top,l=u+i.height;if(u<0)window.scrollTo(0,window.pageYOffset+i.top-n);else if(l>window.innerHeight){var a=window.pageYOffset+i.top-n;a-window.pageYOffset>r&&(a=window.pageYOffset+r);var s=window.pageYOffset-(window.innerHeight-l);s>a&&(s=a),window.scrollTo(0,s)}}}},{key:"menuContainerIsBody",get:function e(){return this.tribute.menuContainer===document.body||!this.tribute.menuContainer}}]),t}(),f=function(){function t(n){e(this,t),this.tribute=n,this.tribute.search=this}return n(t,[{key:"simpleFilter",value:function e(t,n){var i=this;return n.filter((function(e){return i.test(t,e)}))}},{key:"test",value:function e(t,n){return null!==this.match(t,n)}},{key:"match",value:function e(t,n,i){i=i||{};var r=n.length,o=i.pre||"",u=i.post||"",l=i.caseSensitive&&n||n.toLowerCase();if(i.skip)return{rendered:n,score:0};t=i.caseSensitive&&t||t.toLowerCase();var a=this.traverse(l,t,0,0,[]);return a?{rendered:this.render(n,a.cache,o,u),score:a.score}:null}},{key:"traverse",value:function e(t,n,i,r,o){if(this.tribute.autocompleteSeparator&&(n=n.split(this.tribute.autocompleteSeparator).splice(-1)[0]),n.length===r)return{score:this.calculateScore(o),cache:o.slice()};if(!(t.length===i||n.length-r>t.length-i)){for(var u=n[r],l=t.indexOf(u,i),a,s;l>-1;){if(o.push(l),s=this.traverse(t,n,l+1,r+1,o),o.pop(),!s)return a;(!a||a.score<s.score)&&(a=s),l=t.indexOf(u,l+1)}return a}}},{key:"calculateScore",value:function e(t){var n=0,i=1;return t.forEach((function(e,r){r>0&&(t[r-1]+1===e?i+=i+1:i=1),n+=i})),n}},{key:"render",value:function e(t,n,i,r){var o=t.substring(0,n[0]);return n.forEach((function(e,u){o+=i+t[e]+r+t.substring(e+1,n[u+1]?n[u+1]:t.length)})),o}},{key:"filter",value:function e(t,n,i){var r=this;return i=i||{},n.reduce((function(e,n,o,u){var l=n;i.extract&&((l=i.extract(n))||(l=""));var a=r.match(t,l,i);return null!=a&&(e[e.length]={string:a.rendered,score:a.score,index:o,original:n}),e}),[]).sort((function(e,t){var n=t.score-e.score;return n||e.index-t.index}))}}]),t}(),m;return function(){function t(n){var i=this,r=n.values,o=void 0===r?null:r,u=n.loadingItemTemplate,l=void 0===u?null:u,a=n.iframe,s=void 0===a?null:a,m=n.selectClass,p=void 0===m?"highlight":m,v=n.containerClass,g=void 0===v?"tribute-container":v,b=n.itemClass,y=void 0===b?"":b,w=n.trigger,T=void 0===w?"@":w,C=n.autocompleteMode,S=void 0!==C&&C,E=n.autocompleteSeparator,k=void 0===E?null:E,x=n.selectTemplate,M=void 0===x?null:x,A=n.menuItemTemplate,L=void 0===A?null:A,I=n.lookup,N=void 0===I?"key":I,O=n.fillAttr,D=void 0===O?"value":O,P=n.collection,R=void 0===P?null:P,W=n.menuContainer,H=void 0===W?null:W,B=n.noMatchTemplate,F=void 0===B?null:B,_=n.requireLeadingSpace,j=void 0===_||_,Y=n.allowSpaces,z=void 0!==Y&&Y,K=n.replaceTextSuffix,q=void 0===K?null:K,U=n.positionMenu,X=void 0===U||U,Q=n.spaceSelectsMatch,V=void 0!==Q&&Q,G=n.searchOpts,J=void 0===G?{}:G,Z=n.menuItemLimit,ee=void 0===Z?null:Z,te=n.menuShowMinLength,ne=void 0===te?0:te,ie;if(e(this,t),this.autocompleteMode=S,this.autocompleteSeparator=k,this.menuSelected=0,this.current={},this.inputEvent=!1,this.isActive=!1,this.menuContainer=H,this.allowSpaces=z,this.replaceTextSuffix=q,this.positionMenu=X,this.hasTrailingSpace=!1,this.spaceSelectsMatch=V,this.autocompleteMode&&(T="",z=!1),o)this.collection=[{trigger:T,iframe:s,selectClass:p,containerClass:g,itemClass:y,selectTemplate:(M||t.defaultSelectTemplate).bind(this),menuItemTemplate:(L||t.defaultMenuItemTemplate).bind(this),noMatchTemplate:(ie=F,"string"==typeof ie?""===ie.trim()?null:ie:"function"==typeof ie?ie.bind(i):F||function(){return"<li>No Match Found!</li>"}.bind(i)),lookup:N,fillAttr:D,values:o,loadingItemTemplate:l,requireLeadingSpace:j,searchOpts:J,menuItemLimit:ee,menuShowMinLength:ne}];else{if(!R)throw new Error("[Tribute] No collection specified.");this.autocompleteMode&&console.warn("Tribute in autocomplete mode does not work for collections"),this.collection=R.map((function(e){return{trigger:e.trigger||T,iframe:e.iframe||s,selectClass:e.selectClass||p,containerClass:e.containerClass||g,itemClass:e.itemClass||y,selectTemplate:(e.selectTemplate||t.defaultSelectTemplate).bind(i),menuItemTemplate:(e.menuItemTemplate||t.defaultMenuItemTemplate).bind(i),noMatchTemplate:function(e){return"string"==typeof e?""===e.trim()?null:e:"function"==typeof e?e.bind(i):F||function(){return"<li>No Match Found!</li>"}.bind(i)}(F),lookup:e.lookup||N,fillAttr:e.fillAttr||D,values:e.values,loadingItemTemplate:e.loadingItemTemplate,requireLeadingSpace:e.requireLeadingSpace,searchOpts:e.searchOpts||J,menuItemLimit:e.menuItemLimit||ee,menuShowMinLength:e.menuShowMinLength||ne}}))}new d(this),new c(this),new h(this),new f(this)}return n(t,[{key:"triggers",value:function e(){return this.collection.map((function(e){return e.trigger}))}},{key:"attach",value:function e(t){if(!t)throw new Error("[Tribute] Must pass in a DOM node or NodeList.");if("undefined"!=typeof jQuery&&t instanceof jQuery&&(t=t.get()),t.constructor===NodeList||t.constructor===HTMLCollection||t.constructor===Array)for(var n=t.length,i=0;i<n;++i)this._attach(t[i]);else this._attach(t)}},{key:"_attach",value:function e(t){t.hasAttribute("data-tribute")&&console.warn("Tribute was already bound to "+t.nodeName),this.ensureEditable(t),this.events.bind(t),t.setAttribute("data-tribute",!0)}},{key:"ensureEditable",value:function e(n){if(-1===t.inputTypes().indexOf(n.nodeName)){if(!n.contentEditable)throw new Error("[Tribute] Cannot bind to "+n.nodeName);n.contentEditable=!0}}},{key:"createMenu",value:function e(t){var n=this.range.getDocument().createElement("div"),i=this.range.getDocument().createElement("ul");return n.className=t,n.appendChild(i),this.menuContainer?this.menuContainer.appendChild(n):this.range.getDocument().body.appendChild(n)}},{key:"showMenuFor",value:function e(t,n){var r=this;if(!this.isActive||this.current.element!==t||this.current.mentionText!==this.currentMentionTextSnapshot){this.currentMentionTextSnapshot=this.current.mentionText,this.menu||(this.menu=this.createMenu(this.current.collection.containerClass),t.tributeMenu=this.menu,this.menuEvents.bind(this.menu)),this.isActive=!0,this.menuSelected=0,this.current.mentionText||(this.current.mentionText="");var o=function e(t){if(r.isActive){var o=r.search.filter(r.current.mentionText,t,{pre:r.current.collection.searchOpts.pre||"<span>",post:r.current.collection.searchOpts.post||"</span>",skip:r.current.collection.searchOpts.skip,extract:function e(t){if("string"==typeof r.current.collection.lookup)return t[r.current.collection.lookup];if("function"==typeof r.current.collection.lookup)return r.current.collection.lookup(t,r.current.mentionText);throw new Error("Invalid lookup attribute, lookup must be string or function.")}});r.current.collection.menuItemLimit&&(o=o.slice(0,r.current.collection.menuItemLimit)),r.current.filteredItems=o;var u=r.menu.querySelector("ul");if(r.range.positionMenuAtCaret(n),!o.length){var l=new CustomEvent("tribute-no-match",{detail:r.menu});return r.current.element.dispatchEvent(l),void("function"==typeof r.current.collection.noMatchTemplate&&!r.current.collection.noMatchTemplate()||!r.current.collection.noMatchTemplate?r.hideMenu():"function"==typeof r.current.collection.noMatchTemplate?u.innerHTML=r.current.collection.noMatchTemplate():u.innerHTML=r.current.collection.noMatchTemplate)}u.innerHTML="";var a=r.range.getDocument().createDocumentFragment();o.forEach((function(e,t){var n=r.range.getDocument().createElement("li");n.setAttribute("data-index",t),n.className=r.current.collection.itemClass,n.addEventListener("mousemove",(function(e){var t,n=i(r._findLiTarget(e.target),2),o=n[0],u=n[1];0!==e.movementY&&r.events.setActiveLi(u)})),r.menuSelected===t&&n.classList.add(r.current.collection.selectClass),n.innerHTML=r.current.collection.menuItemTemplate(e),a.appendChild(n)})),u.appendChild(a)}};"function"==typeof this.current.collection.values?(this.current.collection.loadingItemTemplate&&(this.menu.querySelector("ul").innerHTML=this.current.collection.loadingItemTemplate,this.range.positionMenuAtCaret(n)),this.current.collection.values(this.current.mentionText,o)):o(this.current.collection.values)}}},{key:"_findLiTarget",value:function e(t){if(!t)return[];var n=t.getAttribute("data-index");return n?[t,n]:this._findLiTarget(t.parentNode)}},{key:"showMenuForCollection",value:function e(t,n){t!==document.activeElement&&this.placeCaretAtEnd(t),this.current.collection=this.collection[n||0],this.current.externalTrigger=!0,this.current.element=t,t.isContentEditable?this.insertTextAtCursor(this.current.collection.trigger):this.insertAtCaret(t,this.current.collection.trigger),this.showMenuFor(t)}},{key:"placeCaretAtEnd",value:function e(t){if(t.focus(),void 0!==window.getSelection&&void 0!==document.createRange){var n=document.createRange();n.selectNodeContents(t),n.collapse(!1);var i=window.getSelection();i.removeAllRanges(),i.addRange(n)}else if(void 0!==document.body.createTextRange){var r=document.body.createTextRange();r.moveToElementText(t),r.collapse(!1),r.select()}}},{key:"insertTextAtCursor",value:function e(t){var n,i;(i=(n=window.getSelection()).getRangeAt(0)).deleteContents();var r=document.createTextNode(t);i.insertNode(r),i.selectNodeContents(r),i.collapse(!1),n.removeAllRanges(),n.addRange(i)}},{key:"insertAtCaret",value:function e(t,n){var i=t.scrollTop,r=t.selectionStart,o=t.value.substring(0,r),u=t.value.substring(t.selectionEnd,t.value.length);t.value=o+n+u,r+=n.length,t.selectionStart=r,t.selectionEnd=r,t.focus(),t.scrollTop=i}},{key:"hideMenu",value:function e(){this.menu&&(this.menu.style.cssText="display: none;",this.isActive=!1,this.menuSelected=0,this.current={})}},{key:"selectItemAtIndex",value:function e(t,n){if("number"==typeof(t=parseInt(t))&&!isNaN(t)){var i=this.current.filteredItems[t],r=this.current.collection.selectTemplate(i);null!==r&&this.replaceText(r,n,i)}}},{key:"replaceText",value:function e(t,n,i){this.range.replaceTriggerText(t,!0,!0,n,i)}},{key:"_append",value:function e(t,n,i){if("function"==typeof t.values)throw new Error("Unable to append to values, as it is a function.");t.values=i?n:t.values.concat(n)}},{key:"append",value:function e(t,n,i){var r=parseInt(t);if("number"!=typeof r)throw new Error("please provide an index for the collection to update.");var o=this.collection[r];this._append(o,n,i)}},{key:"appendCurrent",value:function e(t,n){if(!this.isActive)throw new Error("No active state. Please use append instead and pass an index.");this._append(this.current.collection,t,n)}},{key:"detach",value:function e(t){if(!t)throw new Error("[Tribute] Must pass in a DOM node or NodeList.");if("undefined"!=typeof jQuery&&t instanceof jQuery&&(t=t.get()),t.constructor===NodeList||t.constructor===HTMLCollection||t.constructor===Array)for(var n=t.length,i=0;i<n;++i)this._detach(t[i]);else this._detach(t)}},{key:"_detach",value:function e(t){var n=this;this.events.unbind(t),t.tributeMenu&&this.menuEvents.unbind(t.tributeMenu),setTimeout((function(){t.removeAttribute("data-tribute"),n.isActive=!1,t.tributeMenu&&t.tributeMenu.remove()}))}},{key:"isActive",get:function e(){return this._isActive},set:function e(t){if(this._isActive!=t&&(this._isActive=t,this.current.element)){var n=new CustomEvent("tribute-active-".concat(t));this.current.element.dispatchEvent(n)}}}],[{key:"defaultSelectTemplate",value:function e(t){return void 0===t?"".concat(this.current.collection.trigger).concat(this.current.mentionText):this.range.isContentEditable(this.current.element)?'<span class="tribute-mention">'+(this.current.collection.trigger+t.original[this.current.collection.fillAttr])+"</span>":this.current.collection.trigger+t.original[this.current.collection.fillAttr]}},{key:"defaultMenuItemTemplate",value:function e(t){return t.string}},{key:"inputTypes",value:function e(){return["TEXTAREA","INPUT"]}}]),t}()}));